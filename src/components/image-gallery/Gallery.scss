@use 'sass:map';

@import 'common-styles/palette.scss';
@import 'common-styles/animation.scss';
@import 'common-styles/typography.scss';
@import 'common-styles/consts.scss';

.gallery-main {
  $shadowSize: 0.2rem;

  width: 100%;
  max-width: 100%;
  height: 100%;
  max-height: 32rem;
  overflow: visible;

  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;

  position: relative;

  perspective: $perspective;

  @extend .fade-in;

  & > .gallery-item {
    position: absolute;
    top: $shadowSize;
    bottom: $shadowSize;
    margin-inline: auto;

    width: auto;
    height: calc(100% - $shadowSize * 2);
    overflow: visible;

    transition: transform 0.4s $smooth;

    $shiftStepBase: var(--galleryHeight, 256px);
    $angleStart: 60deg;
    $angleStep: 10deg;
    $angleMax: 90deg;
    $scaleFactor: 0.618;

    &.pos-0 {
      z-index: 33;
      transform: translateX(0) rotate(0) scale(1);
      & > img {
        box-shadow: 0 0 0 $shadowSize desaturate(lighten(teal, 20%), 50%);

        &.reflection {
          opacity: 0.25;
        }
      }
    }
    //NOTE: increase `through` value to support more images in the gallery
    @for $i from 1 through 32 {
      &.pos-#{$i} {
        z-index: 33 - $i;
        transform: translateX(calc(#{$shiftStepBase} * pow($i, 0.5) * 1.25))
          rotateY(-($angleStart + $angleStep * ($i - 1)))
          scale($scaleFactor);
      }
      &.pos--#{$i} {
        z-index: 33 - $i;
        transform: translateX(calc(#{$shiftStepBase} * pow($i, 0.5) * -1.25))
          rotateY(($angleStart + $angleStep * ($i - 1)))
          scale($scaleFactor);
      }
    }

    & > img {
      width: auto;
      height: auto;
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;

      border-radius: 1rem;
      box-shadow: 0 0 0 $shadowSize desaturate(lighten($backgroundLight, 20%), 50%);

      opacity: 0;
      transition:
        opacity 0.4s ease-in,
        box-shadow 0.4s ease-in-out,
        transform 0.4s $smooth;
      &.loaded {
        opacity: 1;
      }

      &.reflection {
        pointer-events: none;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;

        z-index: -1;
        transform: translateY(calc(100% + 0.5rem)) scaleY(-1);
        opacity: 1;

        mask-image: linear-gradient(to bottom, transparent 50%, rgba(#000, 0.3) 100%);
      }
    }

    & > .content {
      pointer-events: none;

      @extend .text-medium;
      text-align: center;
      position: absolute;
      left: 0;
      right: 0;
      overflow: hidden;
      backdrop-filter: blur(2px);
      overflow: hidden;
      border-top: 2px solid;
      border-bottom-left-radius: 1rem;
      border-bottom-right-radius: 1rem;

      @each $name, $colors in $sectionColors {
        .#{$name} & {
          background-color: rgba(map.get($colors, 'background'), 0.5);
          border-color: map.get($colors, 'background');
        }
      }

      padding: 1rem 0.5rem;
      opacity: 0;
      transform: translateY(0%);

      transition:
        opacity 0.4s ease-in,
        transform 0.4s $smooth;
    }
    &.pos-0:has(img:not(.reflection):hover) > .content,
    &.pos-0 > .content:hover {
      opacity: 1;
      transform: translateY(calc(-100% - $shadowSize));
      pointer-events: all;
    }

    & > .options {
      position: absolute;
      z-index: 35;
      top: 0;
      right: 0;
      left: auto;
      padding: 0.5rem;
      overflow: hidden;
      border-radius: 1rem;

      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: flex-end;

      opacity: 0;
      transform: scale(0);
      transition:
        opacity 0.4s ease-in,
        transform 0.4s $smooth;

      & > button.icon {
        color: currentColor;
        background-color: rgba($backgroundLight, 0.5);
        @each $name, $colors in $sectionColors {
          .#{$name} & {
            background-color: rgba(map.get($colors, 'background'), 0.5);
          }
        }
      }
    }
    &.pos-0:hover > .options {
      opacity: 1;
      transform: scale(1);
    }
  }

  & > .gallery-navigation-button {
    color: currentColor;
    @each $name, $colors in $sectionColors {
      .#{$name} & {
        background-color: rgba(desaturate(lighten(map.get($colors, 'background'), 50%), 75%), 0.25);
      }
    }

    border-color: transparent;
    border-radius: 1rem;
    &:active {
      border-color: transparent !important;
    }
    & > * {
      opacity: 0.8;
    }

    transition: opacity 0.2s ease-in-out;
    opacity: 0;
    &:disabled {
      pointer-events: none;
    }
    &:not(:disabled):hover {
      opacity: 1;
    }

    position: absolute;

    width: calc(50% - 16rem);
    @media screen and (max-width: 48rem) {
      width: calc(50% - 4rem);
    }
    max-width: 25%;
    @media screen and (max-width: 32rem) {
      width: 50%;
      max-width: 50%;
    }

    height: calc(100% - 8rem);
    min-height: 61.8%;

    z-index: 34;
    margin-block: auto;
    &.left {
      left: 0;
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
    }
    &.right {
      right: 0;
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }
  }
}

.gallery-main {
  animation-play-state: paused;
}

.section-active .gallery-main {
  animation-play-state: running;
}
